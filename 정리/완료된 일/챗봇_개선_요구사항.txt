===============================================
챗봇 개선 요구사항 정리
===============================================

📌 1. 선호시간 추가 기능
-----------------------------------------------
[현재 문제]
- 챗봇으로 "일정 추가해줘" → personalTimes(개인시간, 불가능한 시간)로만 추가됨
- 선호시간(scheduleExceptions)으로 추가할 방법이 없음

[개선 요구사항]
✅ 사용자가 "몇월 몇일 9-12시 선호시간으로 해줘" 입력 시
   → scheduleExceptions에 추가 (달력의 파란색 영역)

✅ 우선순위 처리 규칙:
   - 우선순위를 명시하지 않으면 → 디폴트로 "선호(priority: 3)" 지정
   - 우선순위를 명시하면 → 해당 값으로 지정
     * "선호" = 3 (파란색)
     * "보통" = 2 (초록색)
     * "조정 가능" = 1 (노란색)

[예시]
사용자: "12월 5일 9시부터 12시까지 선호시간으로 해줘"
→ { priority: 3, startDateTime: "2025-12-05T09:00", endDateTime: "2025-12-05T12:00" }

사용자: "12월 5일 9시부터 12시까지 보통으로 해줘"
→ { priority: 2, startDateTime: "2025-12-05T09:00", endDateTime: "2025-12-05T12:00" }


📌 2. 반복 패턴 지원 (현재 미지원)
-----------------------------------------------
[현재 문제]
- 개인시간, 선호시간 모두 단일 날짜만 추가 가능
- "이번달 전부", "매주 월요일" 같은 반복 패턴 미지원

[개선 요구사항]
✅ 반복 패턴 인식 및 처리:
   - "이번달 전부 9-12시 선호시간으로 해줘"
     → 이번달 모든 날짜에 9-12시 선호시간 추가

   - "매주 월요일 오전 9시부터 12시까지 선호시간으로 해줘"
     → 매주 월요일마다 반복되는 선호시간 추가

   - "12월 1일부터 12월 10일까지 매일 9-12시 선호시간으로 해줘"
     → 범위 내 모든 날짜에 선호시간 추가

[데이터 구조 예시]
{
  "intent": "add_preferred_time",
  "priority": 3,
  "startTime": "09:00",
  "endTime": "12:00",
  "recurrenceType": "monthly" | "weekly" | "daily" | "range",
  "dates": ["2025-12-01", "2025-12-02", ...] // 또는
  "dayOfWeek": 1, // 월요일
  "startDate": "2025-12-01",
  "endDate": "2025-12-10"
}


📌 3. LLM 판단 로직 개선 (핵심!)
-----------------------------------------------
[현재 문제]
❌ 지금은 하드코딩된 패턴 매칭 수준:
   - "오늘 일정 내일로" → { targetDate: new Date().getDate() + 1 }
   - "어제 일정 내일로" → { sourceDay: new Date().getDate() - 1 }

   이렇게 하면:
   1) 문자열 오타 하나만 나도 인식 실패
   2) "동일 문장을 조금 다르게 말하면" 규칙 밖이라 대응 불가
   3) LLM이 아니라 if-else 시스템임

[개선 방향]
✅ 진짜 LLM 방식: 규칙을 직접 적지 말고, LLM에게 자연어 → 액션 변환을 맡김

[프롬프트 지침 예시]
"""
사용자가 입력한 자연어 요청을 이해해서 일정 관리 액션을 생성하세요.

가능한 액션 타입:
- add_preferred_time: 선호시간 추가
- add_personal_time: 개인시간(불가능한 시간) 추가
- date_change: 일정 날짜 이동
- time_change: 시간만 변경
- create: 일반 일정 생성
- delete: 일정 삭제
- edit: 일정 수정
- coordination_request: 다른 사람과 조정 요청

중요한 규칙:
1. "오늘, 내일, 어제"는 현재 날짜({currentDate}) 기준으로 계산
2. "이번 주", "다음 주"는 월요일~일요일 기준
3. "이번 달"은 {currentMonth}월 1일~말일
4. 우선순위 미지정 시 디폴트: "선호(3)"
5. "선호시간" 키워드가 있으면 add_preferred_time 사용
6. "개인시간", "불가능한 시간" 키워드가 있으면 add_personal_time 사용
7. 반복 패턴 인식:
   - "매주 X요일" → recurrenceType: "weekly", dayOfWeek: X
   - "이번달 전부" → recurrenceType: "monthly"
   - "X일부터 Y일까지" → recurrenceType: "range"

응답 JSON 형식:
{
  "intent": "액션 타입",
  "priority": 1~3 (해당되는 경우),
  "startDateTime": "ISO 8601 형식",
  "endDateTime": "ISO 8601 형식",
  "title": "일정 제목",
  "recurrenceType": "weekly | monthly | daily | range (해당되는 경우)",
  "dayOfWeek": 1~7 (해당되는 경우),
  "dates": ["YYYY-MM-DD", ...] (해당되는 경우)
}
"""

이렇게 하면:
✅ LLM이 자연어를 직접 해석
✅ "오늘", "내일", "이번주" 등을 자율적으로 판단
✅ 문장 표현이 달라져도 의도 파악 가능
✅ 새로운 패턴도 학습 없이 대응 가능


📌 4. 구현 우선순위
-----------------------------------------------
1순위: LLM 프롬프트 개선 (가장 중요!)
2순위: 선호시간 추가 기능
3순위: 반복 패턴 지원


📌 5. 기대 효과
-----------------------------------------------
✅ 사용자가 자연스러운 한국어로 요청 가능
✅ "오늘", "내일" 같은 상대적 시간 표현 자동 처리
✅ 우선순위 자동 추론 (명시 안 하면 "선호" 기본값)
✅ 반복 일정도 한 번에 생성 가능
✅ 하드코딩 없이 LLM이 자율적으로 판단


===============================================
작성일: 2025-12-01
===============================================

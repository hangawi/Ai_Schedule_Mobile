================================================================================
AI 일정 조정 시스템 - 프로젝트 파일 구조
================================================================================
작성일: 2025-12-01
설명: 전체 프로젝트의 파일 및 폴더 구조 상세 설명

================================================================================
📁 프로젝트 개요
================================================================================

이 프로젝트는 AI 기반 일정 조정 시스템입니다.
- 백엔드: Node.js + Express + MongoDB
- 프론트엔드: React
- AI: Google Gemini API

주요 기능:
✓ 사용자 선호시간 기반 자동 일정 배정
✓ AI 챗봇을 통한 자연어 일정 조정
✓ 시간 교환 요청 및 승인/거절
✓ 연쇄 교환 (A → B → C → D)
✓ Google Calendar 연동

================================================================================
📂 최상위 폴더 구조
================================================================================

Ai_Schedule/
├── client/          # 프론트엔드 (React 앱)
├── server/          # 백엔드 (Node.js + Express)
├── .env             # 환경 변수 (DB 주소, API 키 등)
├── .gitignore       # Git 제외 파일 목록
├── package.json     # 프로젝트 메타데이터 및 의존성
└── README.md        # 프로젝트 설명 문서

================================================================================
🖥️  서버 (Server) 구조
================================================================================

server/
│
├── 📁 models/                         # MongoDB 스키마 정의
│   ├── user.js                        # 사용자 모델
│   │   ├─ 기본 정보 (이름, 이메일, 비밀번호)
│   │   ├─ defaultSchedule (선호시간)
│   │   ├─ scheduleExceptions (예외 일정)
│   │   └─ personalTimes (개인 시간)
│   │
│   ├── room.js                        # 조정 방 모델
│   │   ├─ 방 정보 (이름, 방장)
│   │   ├─ members (멤버 목록)
│   │   ├─ timeSlots (배정된 시간표)
│   │   └─ requests (교환 요청)
│   │
│   └── event.js                       # 개인 일정 모델
│       └─ Google Calendar 동기화
│
├── 📁 routes/                         # API 엔드포인트 정의
│   ├── auth.js                        # 인증 (로그인/회원가입)
│   ├── events.js                      # 일정 CRUD
│   ├── coordination.js                # 일정 조정 API
│   └── calendar.js                    # 캘린더 연동
│
├── 📁 controllers/                    # 비즈니스 로직 처리
│   │
│   ├── coordinationController.js     # 조정 방 생성/관리
│   │   ├─ 방 생성/수정/삭제
│   │   ├─ 멤버 추가/제거
│   │   └─ 자동 배정 트리거
│   │
│   ├── 📁 coordinationRequestController/    # 교환 요청 처리
│   │   ├── index.js                  # 메인 컨트롤러
│   │   │   ├─ 교환 요청 생성
│   │   │   ├─ 승인/거절 처리
│   │   │   └─ 연쇄 교환 (Chain)
│   │   │
│   │   └── 📁 helpers/               # 헬퍼 함수들
│   │       ├── buildScheduleByDay.js # 요일별 스케줄 구축
│   │       │   ├─ 이번 주 범위 계산
│   │       │   ├─ 선호시간 필터링
│   │       │   └─ 시간대 병합
│   │       │
│   │       ├── findCandidates.js     # 후보 시간 찾기
│   │       └── timeConverter.js      # 시간 변환 유틸
│   │
│   ├── 📁 coordinationExchangeController/   # 시간 변경 처리
│   │   │
│   │   ├── 📁 services/
│   │   │   ├── dateChangeService.js  # 날짜 변경 서비스
│   │   │   │   ├─ 방장 선호시간 검증
│   │   │   │   ├─ 멤버 선호시간 검증
│   │   │   │   ├─ 이번 주 범위 체크
│   │   │   │   └─ 슬롯 제거/생성
│   │   │   │
│   │   │   └── geminiService.js      # Gemini AI 호출
│   │   │       └─ 자연어 처리
│   │   │
│   │   ├── 📁 helpers/
│   │   │   ├── autoPlacement.js      # 자동 배치
│   │   │   ├── scheduleOverlap.js    # 스케줄 겹침 검사
│   │   │   └── slotFinder.js         # 빈 슬롯 찾기
│   │   │
│   │   ├── 📁 validators/
│   │   │   ├── dayValidator.js       # 요일 검증
│   │   │   ├── roomValidator.js      # 방 검증
│   │   │   └── timeRangeValidator.js # 시간 범위 검증
│   │   │
│   │   └── 📁 utils/
│   │       ├── dateUtils.js          # 날짜 유틸
│   │       └── timeUtils.js          # 시간 유틸
│   │
│   ├── chatbotController.js          # AI 챗봇 컨트롤러
│   │   ├─ 사용자 메시지 분석
│   │   ├─ 의도 파악
│   │   └─ 응답 생성
│   │
│   └── authController.js             # 인증 컨트롤러
│
├── 📁 services/                       # 핵심 서비스 로직
│   │
│   └── schedulingAlgorithm.js        # 자동 배정 알고리즘
│       ├─ 보통 모드 (선택지 적은 멤버 우선)
│       ├─ 우선순위 모드 (먼저 들어온 멤버 우선)
│       └─ 배정 프로세스:
│           1. 가용 슬롯 수 계산
│           2. 정렬
│           3. 순서대로 배정
│           4. 충돌 방지
│
├── 📁 middleware/                     # 미들웨어
│   ├── auth.js                        # JWT 토큰 검증
│   └── errorHandler.js                # 에러 처리
│
├── 📁 utils/                          # 유틸리티 함수
│   └── dateHelper.js                  # 날짜 헬퍼
│
└── server.js                          # 서버 진입점
    └─ Express 앱 설정 및 실행

================================================================================
🌐 클라이언트 (Client) 구조
================================================================================

client/
├── public/                            # 정적 파일
│   ├── index.html                     # HTML 템플릿
│   └── favicon.ico                    # 파비콘
│
└── src/
    │
    ├── 📁 components/                 # React 컴포넌트
    │   │
    │   ├── 📁 auth/                   # 인증 관련
    │   │   ├── LoginForm.js           # 로그인 폼
    │   │   └── RegisterForm.js        # 회원가입 폼
    │   │
    │   ├── 📁 calendar/               # 캘린더 관련
    │   │   ├── Calendar.js            # 메인 캘린더
    │   │   ├── CalendarView.js        # 캘린더 뷰
    │   │   ├── CoordinationCalendarView.js  # 조정 캘린더
    │   │   └── 📁 DetailTimeGrid/     # 상세 시간 그리드
    │   │       ├── index.js           # 메인 컴포넌트
    │   │       ├── 📁 handlers/       # 이벤트 핸들러
    │   │       ├── 📁 utils/          # 유틸리티
    │   │       └── 📁 constants/      # 상수
    │   │
    │   ├── 📁 chat/                   # 챗봇 관련
    │   │   ├── ChatBox.js             # 챗봇 UI
    │   │   ├── ChatInterface.js       # 챗봇 인터페이스
    │   │   └── MessageList.js         # 메시지 목록
    │   │
    │   └── 📁 tabs/                   # 탭 컴포넌트
    │       ├── CoordinationTab.js     # 일정 맞추기 탭
    │       │   ├─ 방 선택/생성
    │       │   ├─ 멤버 시간표
    │       │   ├─ 교환 요청
    │       │   └─ 챗봇 통합
    │       │
    │       └── ProfileTab.js          # 프로필 탭
    │           ├─ 개인 정보 수정
    │           └─ 선호시간 설정
    │
    ├── 📁 contexts/                   # React Context
    │   └── AuthContext.js             # 인증 상태 관리
    │       ├─ 로그인/로그아웃
    │       ├─ 사용자 정보
    │       └─ JWT 토큰 관리
    │
    ├── 📁 utils/                      # 유틸리티
    │   ├── api.js                     # API 호출 함수
    │   └── dateUtils.js               # 날짜 유틸
    │
    ├── App.js                         # 메인 앱 컴포넌트
    │   ├─ 라우팅 설정
    │   ├─ Context Providers
    │   └─ 레이아웃
    │
    └── index.js                       # React 진입점

================================================================================
🔄 주요 데이터 흐름
================================================================================

1. 자동 배정 흐름
   ┌─────────────┐
   │ 사용자 클릭  │ (프론트엔드)
   └──────┬──────┘
          │ POST /api/coordination/auto-assign
          ▼
   ┌─────────────────────┐
   │ coordinationController│ (백엔드)
   └──────┬──────────────┘
          │ schedulingAlgorithm.js 호출
          ▼
   ┌─────────────────────┐
   │ 자동 배정 알고리즘    │
   │ 1. 가용 슬롯 계산    │
   │ 2. 정렬             │
   │ 3. 순서대로 배정     │
   └──────┬──────────────┘
          │ Room.save()
          ▼
   ┌─────────────┐
   │  MongoDB    │
   └─────────────┘

2. 교환 요청 흐름
   ┌─────────────┐
   │ A 사용자     │
   │ "B의 시간과  │
   │  교환하고싶어"│
   └──────┬──────┘
          │ POST /api/coordination/requests
          ▼
   ┌──────────────────────────┐
   │ coordinationRequestController│
   │ 1. B 빈 시간 확인        │
   │ 2. 빈 시간 있으면 직접 교환│
   │ 3. 없으면 연쇄 요청 생성  │
   └──────┬───────────────────┘
          │
          ▼
   ┌─────────────┐
   │ B 사용자     │
   │ 승인/거절 대기│
   └──────┬──────┘
          │ POST /api/coordination/requests/:id/approved
          ▼
   ┌──────────────────┐
   │ 교환 실행        │
   │ 1. A → B 시간    │
   │ 2. B → 빈 시간   │
   └──────────────────┘

3. AI 챗봇 흐름
   ┌─────────────┐
   │ 사용자       │
   │ "화요일로    │
   │  바꿔줘"     │
   └──────┬──────┘
          │ POST /api/chatbot/message
          ▼
   ┌─────────────────────┐
   │ chatbotController    │
   │ 1. Gemini AI 호출   │
   │ 2. 의도 파악        │
   └──────┬──────────────┘
          │ "시간 변경 의도 감지"
          ▼
   ┌─────────────────────┐
   │ dateChangeService    │
   │ 1. 검증             │
   │ 2. 시간 변경 실행   │
   └─────────────────────┘

================================================================================
🔑 핵심 파일 설명
================================================================================

1. server/models/user.js
   - 사용자 스키마 정의
   - defaultSchedule: 주간 반복 선호시간
   - scheduleExceptions: 특정 날짜 선호시간
   - personalTimes: 수면, 식사 등 개인 시간

2. server/services/schedulingAlgorithm.js
   - 자동 배정 알고리즘
   - 선택지 적은 멤버 우선 배정
   - 공평한 시간 분배

3. server/controllers/coordinationRequestController/index.js
   - 교환 요청 처리
   - 연쇄 교환 (Chain Exchange)
   - 빈 시간 자동 찾기

4. server/controllers/coordinationExchangeController/services/dateChangeService.js
   - 날짜 변경 검증
   - 방장/멤버 선호시간 체크
   - 이번 주 범위 필터링

5. server/controllers/coordinationRequestController/helpers/buildScheduleByDay.js
   - 요일별 스케줄 구축
   - 이번 주 범위 계산
   - 반복 일정 vs 특정 날짜 일정 구분

6. server/controllers/chatbotController.js
   - AI 챗봇 로직
   - Gemini API 연동
   - 자연어 → API 변환

7. client/src/components/tabs/CoordinationTab.js
   - 일정 조정 메인 화면
   - 방 관리, 교환 요청, 챗봇 통합

================================================================================
📝 추가 문서
================================================================================

- 교환_자리변경_프로세스.txt: 교환/연쇄 교환 프로세스 상세 설명
- 자동배정_모드_정리.txt: 자동 배정 알고리즘 상세 설명
- 수정내역_이번주범위체크.txt: 이번 주 범위 체크 수정 내역
- 챗봇_개선_요구사항.txt: 챗봇 개선 사항

================================================================================
끝
================================================================================

================================================================================
교환 & 자리 변경 프로세스 종합 정리
================================================================================
작성일: 2025-12-01

이 문서는 다음 파일들의 내용을 통합한 것입니다:
- 1.txt
- 2.txt
- 4.txt
- 5.txt

================================================================================


================================================================================
원본 파일: 1.txt
================================================================================

# 일정 맞추기 탭 - 시간 변경 프로세스 정리

## 1. 기본 설정
- 방장 가능 시간: 월~금, 09:00~12:00 / 13:00~17:00
- A: 월, 수 가능
- B: 월~금 가능
- 초기 배치: A는 월요일에 배정됨

## 2. 사용자 요청
- 예: A → "수요일로 옮겨줘"

## 3. LLM 처리 흐름

1) 요청 파싱
   - "A 수요일로 이동" 같은 명령을 분석

2) 방장 가능 시간 확인
   - 요청한 요일/시간대가 방장 스케줄과 일치하는지 체크
   - 불가능한 시간대라면 변경 거부

3) 해당 요일/시간 슬롯 확인
   - 이미 다른 멤버가 배정되어 있는지 확인
   - 비어 있지 않으면 충돌 → 변경 불가 또는 조정 필요

4) 모든 조건 충족 시 변경 수행
   - 조건:
     a. 방장이 가능한 시간
     b. 요청한 시간 슬롯이 비어 있음
     c. 요청자(A)가 가능한 시간
   - 모두 충족 시: A의 일정을 해당 요일로 이동

## 4. 전체 흐름 요약

사용자 요청
   ↓
LLM이 명령 파악
   ↓
방장 가능 시간과 비교
   ↓
해당 요일/시간 슬롯 비어 있는지 체크
   ↓
가능 → 일정 이동
불가능 → 사유 안내




================================================================================
원본 파일: 2.txt
================================================================================

# 시간표 재조정(교환) 프로세스 정리

## 1. 기본 상황
- A: 월요일에 배치됨
- B: 수요일에 배치됨
- A는 B가 배치된 '수요일' 시간 슬롯을 원함

## 2. A가 채팅봇에 요청
- "수요일로 바꿔줄 수 있어?"

## 3. LLM의 1차 응답
1) 해당 시간(수요일)에 이미 누가 배치되어 있는지 확인
2) 예: "현재 수요일에는 B가 배치되어 있습니다. 조정을 원하십니까?"

## 4. A가 "네(ㅇㅇ)" 라고 응답
- A가 시간 교환 또는 조정을 원한다고 판단

## 5. LLM의 2차 행동: B에게 알림 or 메시지 발송
- "A님이 수요일 시간대로 이동을 원합니다. 기존의 수요일 자리(A가 원하는 자리)를 양보해 주실 수 있나요?"
- B는 두 가지 선택 가능:
  - ✔ 수락 (Accept)
  - ❌ 거절 (Reject)

## 6. B의 선택에 따른 처리

### ▣ A) B가 거절할 경우
- 재조정 불가
- LLM 응답:
  - "B님이 조정을 거절하셨습니다. 해당 시간으로 이동할 수 없습니다."

### ▣ B) B가 수락할 경우
1) B의 선호 가능 시간표 조회
2) B가 이동 가능한 빈 슬롯 탐색
3) B를 새로운 시간으로 이동
4) A를 B가 사용하던 원래 자리(수요일 슬롯)로 이동

→ 즉, "교환"이 아니라  
   **B가 다른 가능한 슬롯으로 이동 → A가 수요일 슬롯으로 이동**  
   형태의 재배치가 이루어짐

## 7. 전체 흐름 요약

A 요청
   ↓
수요일 슬롯에 B가 있음 확인
   ↓
"조정할까요?" → A OK
   ↓
LLM이 B에게 양보 요청
   ↓
(B 거절) → 실패
(B 수락) → B 새 슬롯으로 이동 → A가 수요일로 이동




================================================================================
원본 파일: 4.txt
================================================================================

# 자리 변경 프로세스 (A → B → C) 로직 정리 — 수정 버전

# 상황:
# - A가 B의 자리를 원한다.
# - B는 요청을 수락할 의사가 있지만,
#   현재 B에게는 이동 가능한 빈 시간이 없다.
# - B의 "선호시간" 중 일부가 다른 사람들이(이하 C) 차지하고 있다.
# - 따라서 B는 자신의 선호시간을 차지한 사람 중에서
#   오늘 이후 가장 가까운 날짜에 있는 사람(C)에게
#   "혹시 남아있는 빈 시간으로 이동해줄 수 있나요?" 라고 요청해야 한다.
# - C가 이동해주면 B가 그 자리를 차지하고, A는 B의 원래 자리를 차지한다.

# --------------------------------------------------------
# 전체 프로세스
# --------------------------------------------------------

# 1. A가 B에게 자리 변경 요청을 보냄
#    예: A → "B 자리로 옮겨줘"

# 2. B가 요청을 확인하고 '승인' 버튼을 누름
#    - 이 승인 버튼을 누르기 전까지는
#      어떠한 후속 조정도 시작되지 않는다.
#    - B가 승인해야 “자리 조정 프로세스”가 시작됨.

# 3. 시스템은 B가 이동할 수 있는 빈 시간(available slots)을 탐색한다
#    - 빈 시간이 있다면:
#          B는 그 빈 시간으로 이동
#          A는 B의 기존 자리로 이동
#          → 조정 완료 (C 없음)
#    - 빈 시간이 없다면:
#          다음 단계로 진행

# 4. B의 "선호시간" 목록을 확인한다
#    - B가 가장 가고 싶은 시간대들 중
#      이미 다른 사람들이 차지하고 있는 시간대를 찾는다
#    - 즉, B가 가고 싶어 했던 자리를 C가 점유 중인 상태

# 5. 오늘 날짜 기준으로,
#    B의 선호시간을 차지하고 있는 사람들 중
#    "오늘 이후 날짜 중 가장 가까운 날짜"에 있는 사람을 선택한다
#
#    예:
#    - 오늘이 19일
#    - 차지한 사람들의 날짜:
#        - 20일
#        - 21일
#    → 20일이 더 가깝기 때문에 해당 사람에게 먼저 요청함

# 6. 시스템은 선택된 사람(C)에게 요청을 보냄:
#    "B가 일정 조정을 위해 필요해서 그런데,
#     혹시 남아있는 빈 시간으로 이동해주실 수 있나요?"

# 7. C의 응답 처리 로직:
#    - 승인:
#          C는 자신의 빈 시간으로 이동
#          B는 C가 원래 가지고 있던 자리로 이동
#          A는 B가 원래 가지고 있던 자리로 이동
#          → 전체 자리 조정 성공
#
#    - 거절:
#          같은 방식으로,
#          B의 선호시간을 차지한 사람들 중
#          오늘 이후 날짜 기준으로
#          다음으로 가까운 사람에게 다시 요청
#
#    - 모든 사람들이 거절하는 경우:
#          → 자리 조정 실패
#            "현재는 조정이 불가능합니다." 반환



================================================================================
원본 파일: 5.txt
================================================================================

# --------------------------------------------------------
# 자리 변경 테스트 - 올바른 로직 + 문제 상황 정리
# --------------------------------------------------------

# 1) 원래 각자 가진 시간
A: 월 9-12, 13-17
B: 월 9-12, 화 9-12
C: 화 9-12, 수 9-12

# 2) 시스템이 각자 3시간씩 자동 배정한 결과
A → 월 9-12
B → 화 9-12
C → 수 9-12

# 3) C가 B 자리(화 9-12)를 원해서 B에게 자리 변경 요청함
#    B는 요청을 승인함 → 여기까지 정상

# 4) 올바른 자리 이동 흐름 (네가 원하는 정답 로직)
# --------------------------------------------------------
# C가 B 자리를 원하면 → B는 A에게 먼저 물어봐야 한다:
#   "A님, 제 자리로 옮겨주실 수 있나요?"

# Case 1: A가 승인할 경우
#   - A → 빈 시간으로 이동
#   - B → A가 가지고 있던 자리로 이동
#   - C → B의 자리(화 9-12)로 이동
#   → 전체 자리 이동 성공

# Case 2: A가 거절할 경우
#   - B는 A에게 더 이상 요청 불가
#   - C도 B 자리(화 9-12)를 받을 수 없음
#   - 전체 자리 이동 실패

# Case 3: B와 A 둘 다 거절
#   - C는 절대 자리 변경 불가
# --------------------------------------------------------

# 5) 실제 발생한 문제 (버그)
#   - C는 B 자리(화 9-12)를 바로 가져버림 (OK)
#   - 하지만 B는 A에게 물어보지 않음 (BUG)
#   - A도 승인/거절 단계가 없음 (BUG)
#   - B는 이동할 자리가 없어져서 '사라짐' (심각한 BUG)
#   - C만 이득 보고 A/B는 제대로 처리되지 않음

# 6) 요약
#   - "B가 A에게 먼저 승인 요청 → A 승인 → A/B/C 순차 이동"
#     이 핵심 플로우가 빠져서 생긴 문제.
# --------------------------------------------------------


